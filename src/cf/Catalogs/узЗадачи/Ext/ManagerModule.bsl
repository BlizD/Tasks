
// СтандартныеПодсистемы.ВерсионированиеОбъектов
// Определяет настройки объекта для подсистемы ВерсионированиеОбъектов.
//
// Параметры:
// Настройки - Структура - настройки подсистемы.
Процедура ПриОпределенииНастроекВерсионированияОбъектов(Настройки) Экспорт
	Настройки.ПриПолученииСлужебныхРеквизитов = Истина;
КонецПроцедуры

// Ограничивает видимость реквизитов объекта в отчете по версии.
//
// Параметры:
// Реквизиты - Массив - список имен реквизитов объекта.
Процедура ПриПолученииСлужебныхРеквизитов(Реквизиты) Экспорт
    //Реквизиты.Добавить("ИмяРеквизита"); // реквизит объекта
    //Реквизиты.Добавить("ИмяТабличнойЧасти.*"); // табличная часть объекта
КонецПроцедуры
// Конец СтандартныеПодсистемы.ВерсионированиеОбъектов

Функция ПолучитьНомерЗадачи(ЗадачаСсылка) Экспорт 
	Возврат Формат(ЗадачаСсылка.Код,"ЧГ=0");
КонецФункции 

Функция ПолучитьКомментарииВКоде(ДопПараметры) Экспорт
	Перем КомментарииВКоде;
	
	пКод = ДопПараметры.Код;
	пИсполнитель = ДопПараметры.Исполнитель;
	пНомерВнешнейЗаявки = ДопПараметры.НомерВнешнейЗаявки;
	
	ФИОИсполнителя = Неопределено;
	Если ЗначениеЗаполнено(пИсполнитель) Тогда
		МассивПодстрок = СтрРазделить(пИсполнитель," ");
		КоличествоСлов = МассивПодстрок.Количество();
		Если КоличествоСлов > 0 Тогда
			ФИОИсполнителя = " "+ МассивПодстрок[0];
		Конецесли;
		Если КоличествоСлов > 1 Тогда
			ФИОИсполнителя = ФИОИсполнителя + " " + Лев(МассивПодстрок[1],1)+".";
		Конецесли;
		Если КоличествоСлов > 2 Тогда
			ФИОИсполнителя = ФИОИсполнителя + "" + Лев(МассивПодстрок[2],1)+".";
		Конецесли;	
	Конецесли;
	пКомментарииВКоде = "//+ #"+Формат(пКод,"ЧГ=0") 
		+ ?(ЗначениеЗаполнено(пНомерВнешнейЗаявки)," "+пНомерВнешнейЗаявки,"")
		+ ФИОИсполнителя
		+ " " + Формат(ТекущаяДата(),"ДФ=yyyy-MM-dd"); 	
		
	Возврат пКомментарииВКоде;	
КонецФункции 

Функция ПолучитьПолныйПутьЗадачи(Задача) Экспорт
	
	Массив = Новый Массив;
	
	ЗаполнитьМассивИерархии(Задача, Массив);
	
	Разделитель = ПолучитьРазделительПутиКлиента();
	Путь = "";
	
	Для Каждого СтрокаМассива ИЗ Массив Цикл	
		Путь = СтрокаМассива + Разделитель + Путь;	
	КонецЦикла;	
	
	Возврат Путь;
	
КонецФункции	

Процедура ЗаполнитьМассивИерархии(Задача, Массив)
	
	НазваниеДляПапки = СобратьНазваниеДляПапки(Задача.Наименование, Задача.Код);
	Массив.Добавить(НазваниеДляПапки);
	
	Если ЗначениеЗаполнено(Задача.Родитель) Тогда
		ЗаполнитьМассивИерархии(Задача.Родитель, Массив);
	КонецЕсли;	
		
КонецПроцедуры	

Функция СобратьНазваниеДляПапки(Наименование, Код)
	
	Шаблон = "#%1 %2";
	СокращенноеНаименование = Лев(Наименование, 30);
	Результат = СтрШаблон(Шаблон, Код, СокращенноеНаименование);
		
	Возврат Результат;

КонецФункции	