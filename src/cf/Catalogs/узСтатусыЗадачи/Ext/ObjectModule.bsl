
Процедура ПриЗаписи(Отказ)
	
	ИзменитьУПодчиненныхЭлементовРеквизиты();
	
КонецПроцедуры

Процедура ИзменитьУПодчиненныхЭлементовРеквизиты()
	
	Если НЕ ДополнительныеСвойства.ИзмененWIPЛимит Тогда
		Возврат;
	Конецесли;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	узСтатусыЗадачи.Ссылка
	|ИЗ
	|	Справочник.узСтатусыЗадачи КАК узСтатусыЗадачи
	|ГДЕ
	|	узСтатусыЗадачи.Ссылка <> &Ссылка
	|	И узСтатусыЗадачи.Ссылка В ИЕРАРХИИ(&Ссылка)";
	
	Запрос.УстановитьПараметр("Ссылка", Ссылка);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Если РезультатЗапроса.Пустой() Тогда
		Возврат;
	Конецесли;
	
	Выборка = РезультатЗапроса.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		СпрОбъект = Выборка.Ссылка.ПолучитьОбъект();
		#Если Тромбон тогда
			СпрОбъект = Справочники.узСтатусыЗадачи.СоздатьЭлемент();
		#Конецесли
		
		СпрОбъект.WIPЛимит = WIPЛимит;
		СпрОбъект.ИспользоватьWIPЛимит = ИспользоватьWIPЛимит;
		СпрОбъект.ИспользоватьWIPЛимитНаИсполнителя = ИспользоватьWIPЛимитНаИсполнителя;
		СпрОбъект.WIPЛимитУказываетсяВРодителе = ИспользоватьWIPЛимит;
		
		СпрОбъект.Записать();
	КонецЦикла;
	

КонецПроцедуры 

Процедура ПередЗаписью(Отказ)
	Если ЭтотОбъект.Уровень() > 1 Тогда
		ВызватьИсключение "Ошибка! в данный момент не реализовано использования больше 2 уровней вложенности элементов";
		//В канбан доске заголовки надо получать рекурсией
		//При получении количество задач в статусе надо учитывать вложенность, тоже рекурсией как то получать
		
	Конецесли;
	
	ИзмененWIPЛимит = Ложь;
	Если НЕ ЭтоНовый() Тогда
		Если ИспользоватьWIPЛимит = Ссылка.ИспользоватьWIPЛимит
			И ИспользоватьWIPЛимитНаИсполнителя = Ссылка.ИспользоватьWIPЛимитНаИсполнителя
			И WIPЛимит = Ссылка.WIPЛимит Тогда
		Иначе
			ИзмененWIPЛимит = Истина;
		Конецесли;
	Конецесли;	
	ДополнительныеСвойства.Вставить("ИзмененWIPЛимит",ИзмененWIPЛимит);	
		
КонецПроцедуры

